webpackJsonp([12],{"1r4x":function(e,a){},"5oZU":function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i={data:function(){return{postData:{token:""},bannerImageList:[],resouceOptions:[],contentTypeOptions:[{label:"项目",value:0},{label:"测试",value:2},{disabled:!0,label:"资讯",value:1}],tableData:[],total:0,addFormDialog:{visible:!1,title:"",isAdd:"",bigImgVisible:!1,formLabelWidth:"130px",formInputWidth:"400px",form:{id:"",imageSrc:"",validTimeStart:"",validTimeEnd:"",validTime:"",contentType:0,resouceLink:""}},searchForm:{validTime:[],validTimeStart:"",validTimeEnd:"",currentPage:1,pageSize:10}}},mounted:function(){this.getQiniuToken(),this.handleSearch(),this.handleProjectListAll()},watch:{"searchForm.validTime":function(e,a){this.searchForm.validTimeStart=e[0],this.searchForm.validTimeEnd=e[1]},"addFormDialog.form.validTime":function(e,a){this.addFormDialog.form.validTimeStart=e[0],this.addFormDialog.form.validTimeEnd=e[1]}},methods:{handleSearch:function(){var e=this,a=e.$api.layoutBannerList;console.log(e.searchForm),e.$axiosPOST(a,e.searchForm,function(a){e.tableData=a.data.list,e.total=a.data.total})},handleShowAddForm:function(e){if(this.addFormDialog.form.validTime=[],this.addFormDialog.form.validTimeStart="",this.addFormDialog.form.validTimeEnd="",this.addFormDialog.form.imageSrc="",this.addFormDialog.form.contentType=0,this.addFormDialog.form.resouceLink="",this.resouceOptions=[],this.bannerImageList=[],null===e||""===e)this.addFormDialog.title="添加Banner",this.addFormDialog.isAdd=!0;else{for(var a in this.addFormDialog.title="修改Banner",this.addFormDialog.isAdd=!1,e)this.addFormDialog.form[a]=e[a];this.addFormDialog.form.validTime.push(e.validTimeStart),this.addFormDialog.form.validTime.push(e.validTimeEnd),this.handleContentTypeChange()}this.addFormDialog.visible=!0},handleContentTypeChange:function(){0===this.addFormDialog.form.contentType&&this.handleProjectListAll(),1===this.addFormDialog.form.contentType&&alert("资讯列表回调")},handleProjectListAll:function(){var e=this,a=e.$api.sysProjectListAll;e.$axiosPOST(a,e.addFormDialog.form,function(a){for(var t in console.log(a.data),e.resouceOptions=[],a.data){var i=a.data[t];0===e.addFormDialog.form.contentType?e.resouceOptions.push({label:"项目："+i.name+"【"+i.code+"】",value:i.id.toString()}):(e.resouceOptions=[],e.resouceOptions.push({label:"资讯标题",value:i.id}))}})},handleAddBanner:function(){var e=this,a=e.$api.layoutBannerAdd;e.$axiosPOST(a,e.addFormDialog.form,function(a){e.$message("Banner添加成功"),e.handleSearch(),e.addFormDialog.visible=!1})},handleUpdateBanner:function(){var e=this,a=e.$api.layoutBannerUpdate;e.$axiosPOST(a,e.addFormDialog.form,function(a){e.$message("Banner修改成功"),e.handleSearch(),e.addFormDialog.visible=!1})},handleAvatarSuccess:function(e,a){this.$message("Banner已成功上传，请及时提交"),this.addFormDialog.form.imageSrc=this.$api.qiniuImagePreLink+e.key},handleAvatarError:function(e){this.$message("上传失败"),console.log(e)},submitUpload:function(){this.$refs.uploadBatch.submit()},beforeAvatarUpload:function(e){var a="image/jpeg"===e.type,t="image/png"===e.type,i=e.size/1024/1024<2,o=this.bannerImageList.length>0;return o&&this.$alert("只能上传一个Banner图片","提示"),a||t||this.$message.error("上传头像图片只能是 JPG/PNG 格式!"),i||this.$message.error("上传头像图片大小不能超过 2MB!"),!o&&(a||t)&&i},getQiniuToken:function(){var e=this;e.$axiosPOST(e.$api.qiniuToken,{},function(a){e.postData.token=a.data})},handleDeleteBanner:function(e){var a=this;this.$alert("确认删除banner？注意：删除后无法恢复","警告",{type:"warning"}).then(function(t){a.$axiosPOST(a.$api.layoutBannerDelete+"/"+e,{},function(e){a.$message("删除成功"),a.handleSearch()})})},handleClickPage:function(e){this.searchForm.currentPage=e,this.handleSearch()},handleSizeChange:function(e){this.searchForm.pageSize=e,this.handleSearch()},handlePictureCardPreview:function(e){this.addFormDialog.form.imageSrc=e.url,this.addFormDialog.bigImgVisible=!0},handleRemoveUpload:function(e,a){console.log("上传删除：",e,a)},dateFormatter:function(e,a){var t=e[a.property];return void 0===t||null===t?"":this.$formatDate(new Date(t),"YYYY-MM-DD HH:mm:ss")}}},o={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"page-body"},[t("div",{staticClass:"page-header"},[t("el-breadcrumb",[t("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[t("i",{staticClass:"fa fa-home"})]),e._v(" "),t("el-breadcrumb-item",[e._v("Banner 设置")])],1)],1),e._v(" "),t("div",{staticClass:"box"},[t("el-date-picker",{style:{width:"400px"},attrs:{size:"small",type:"datetimerange","value-format":"timestamp","range-separator":"至","start-placeholder":"有效时间起","end-placeholder":"有效时间止",align:"right"},model:{value:e.searchForm.validTime,callback:function(a){e.$set(e.searchForm,"validTime",a)},expression:"searchForm.validTime"}}),e._v(" "),t("p"),e._v(" "),t("m-button",{attrs:{type:"info",size:"small"},on:{click:e.handleSearch}},[t("i",{staticClass:"fa fa-search"},[e._v(" 搜索")])]),e._v(" "),t("m-button",{attrs:{type:"info",size:"small"},on:{click:function(a){e.handleShowAddForm(null)}}},[t("i",{staticClass:"fa fa-plus"},[e._v(" 添加")])]),e._v(" "),t("p"),e._v(" "),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[t("el-table-column",{attrs:{prop:"id",label:"ID",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{label:"Banner"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("img",{attrs:{src:e.row.imageSrc,height:"40"}})]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"validTimeStart",formatter:e.dateFormatter,label:"有效时间起"}}),e._v(" "),t("el-table-column",{attrs:{prop:"validTimeEnd",formatter:e.dateFormatter,label:"有效时间起"}}),e._v(" "),t("el-table-column",{attrs:{prop:"updateTime",formatter:e.dateFormatter,label:"编辑时间"}}),e._v(" "),t("el-table-column",{attrs:{label:"操作",fixed:"right",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){e.handleShowAddForm(a.row)}}},[e._v("编辑")]),e._v(" "),t("el-button",{attrs:{type:"text"},on:{click:function(t){e.handleDeleteBanner(a.row.id)}}},[e._v("刪除")])]}}])})],1),e._v(" "),t("p"),e._v(" "),t("el-pagination",{attrs:{background:"","current-page":e.searchForm.currentPage,"page-sizes":[10,20,30,40],"page-size":e.searchForm.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleClickPage}})],1),e._v(" "),t("el-dialog",{attrs:{title:e.addFormDialog.title,visible:e.addFormDialog.visible},on:{"update:visible":function(a){e.$set(e.addFormDialog,"visible",a)}}},[t("el-form",{ref:"form",attrs:{"label-width":e.addFormDialog.formLabelWidth,model:e.addFormDialog.form}},[t("el-form-item",{attrs:{label:"Banner"}},[t("el-upload",{ref:"upload",style:{width:this.addFormDialog.formInputWidth},attrs:{action:this.$api.qiniuUploadLink,"list-type":"picture","file-list":e.bannerImageList,multiple:!1,data:e.postData,"on-preview":e.handlePictureCardPreview,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload,"on-error":e.handleAvatarError,"on-remove":e.handleRemoveUpload}},[t("el-button",{staticClass:"el-icon-plus",attrs:{size:"mini"}},[e._v(" 添加图片")])],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"内容类型"}},[t("el-select",{style:{width:this.addFormDialog.formInputWidth},attrs:{size:"small",clearable:"",placeholder:"选择内容类型"},on:{change:e.handleContentTypeChange},model:{value:e.addFormDialog.form.contentType,callback:function(a){e.$set(e.addFormDialog.form,"contentType",a)},expression:"addFormDialog.form.contentType"}},e._l(e.contentTypeOptions,function(e,a){return t("el-option",{key:a,attrs:{disabled:e.disabled,label:e.label,value:e.value}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"Banner有效期"}},[t("el-date-picker",{style:{width:this.addFormDialog.formInputWidth},attrs:{size:"small",type:"datetimerange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},model:{value:e.addFormDialog.form.validTime,callback:function(a){e.$set(e.addFormDialog.form,"validTime",a)},expression:"addFormDialog.form.validTime"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"指向内容"}},[t("el-select",{style:{width:this.addFormDialog.formInputWidth},attrs:{size:"small",clearable:"",placeholder:"选择指向内容"},model:{value:e.addFormDialog.form.resouceLink,callback:function(a){e.$set(e.addFormDialog.form,"resouceLink",a)},expression:"addFormDialog.form.resouceLink"}},e._l(e.resouceOptions,function(e,a){return t("el-option",{key:a,attrs:{filterable:"",label:e.label,value:e.value}})}))],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small"},on:{click:function(a){e.addFormDialog.visible=!1}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){e.addFormDialog.isAdd?e.handleAddBanner():e.handleUpdateBanner()}}},[e._v("确 定")])],1)],1),e._v(" "),t("el-dialog",{attrs:{visible:e.addFormDialog.bigImgVisible},on:{"update:visible":function(a){e.$set(e.addFormDialog,"bigImgVisible",a)}}},[t("img",{attrs:{width:"100%",src:e.addFormDialog.form.imageSrc,alt:""}})])],1)},staticRenderFns:[]};var l=t("C7Lr")(i,o,!1,function(e){t("1r4x")},null,null);a.default=l.exports}});
//# sourceMappingURL=12.6ba126ea55c7dca01659.js.map